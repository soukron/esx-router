# Autogenerated cluster entries
{% for cluster in clusters_expanded | default([]) %}
{% set padding = cluster.node_name_padding | default(2) %}
{% set fmt = "%0" ~ padding ~ "d" %}

# {{ cluster.domain }}
{% if cluster.network is defined %}
domain={{ cluster.domain }},{{ cluster.network }},local
{% endif %}

######
# DNS
######
{% if cluster.bootstrap_ip is defined %}
host-record=bootstrap.{{ cluster.domain }},{{ cluster.bootstrap_ip }}
{% endif %}
{% for ip in cluster.nodes.ips | default([]) %}
host-record={{ cluster.nodes.name_prefix }}{{ fmt | format(loop.index0) }}.{{ cluster.domain }},{{ ip }}
{% endfor %}
{% if cluster.lb.api_vip is defined %}
address=/api.{{ cluster.domain }}/{{ cluster.lb.api_vip }}
address=/api-int.{{ cluster.domain }}/{{ cluster.lb.api_int_vip | default(cluster.lb.api_vip) }}
{% endif %}
{% if cluster.lb.managed | default('') == 'user' and cluster.lb.ingress_vip is defined %}
address=/apps.{{ cluster.domain }}/{{ cluster.lb.ingress_vip }}
{% endif %}

{% if cluster.dhcp_static | default(false) %}
#######
# DHCP
#######
{% set mac_prefix = cluster.dhcp_mac_prefix | default('00:50:56') %}
{% set lease_time = cluster.dhcp_lease_time | default('3d') %}
{% for ip in cluster.nodes.ips | default([]) %}
{% set octets = ip.split('.') %}
{% set net_octet = octets[1] | int %}
{% set subnet_octet = octets[2] | int %}
{% set host_octet = octets[3] | int %}
{% set mac_net = "%02x" | format(net_octet) %}
{% set mac_subnet = "%02x" | format(subnet_octet) %}
{% set mac_host = "%02x" | format(host_octet) %}
dhcp-host={{ mac_prefix }}:{{ mac_net }}:{{ mac_subnet }}:{{ mac_host }},{{ cluster.nodes.name_prefix }}{{ fmt | format(loop.index0) }}.{{ cluster.domain }},{{ ip }},{{ lease_time }}
{% endfor %}
{% endif %}

{% endfor %}
